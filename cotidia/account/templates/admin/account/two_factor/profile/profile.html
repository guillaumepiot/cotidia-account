{% extends "admin/page.html" %}
{% load i18n two_factor %}

{% block title %}
	{% trans "Account Security" %}
{% endblock title %}

{% block toolbar %}
	<span class="toolbar__title">{% trans "Account Security" %}</span>
{% endblock toolbar %}

{% block content %}
  {% if default_device %}

    <div class="[ content__inner ] [ box box--padded box--bordered ]">
    	<fieldset>
    		<legend>{% trans "Device type" %}</legend>
            {% if default_device_type == 'TOTPDevice' %}
              <p>{% trans "Tokens will be generated by your token generator." %}</p>
            {% elif default_device_type == 'PhoneDevice' %}
              <p>{% blocktrans with primary=default_device|device_action %}Primary method: <span class="label label--primary">{{ primary }}</span>{% endblocktrans %}</p>
            {% elif default_device_type == 'RemoteYubikeyDevice' %}
              <p>{% blocktrans %}Tokens will be generated by your YubiKey.{% endblocktrans %}</p>
            {% endif %}
    	</fieldset>
    </div>

    <div class="[ content__inner ] [ box box--padded box--bordered ]">
        <fieldset>
            <legend>{% trans "Backup Phone Numbers" %}</legend>
            <p>{% blocktrans %}If your primary method is not available, we are able to
            send backup tokens to the phone numbers listed below.{% endblocktrans %}</p>
            {% if backup_phones %}
                <table class="table">
                    <tr class="table-row">
                        <th colspan="2" class="table-head-cell">
                            Device
                        </th>
                    </tr>
                {% for phone in backup_phones %}
                    <tr class="table-row">
                        <td class="table-cell">
                            {{ phone|device_action }}
                        </td>
                        <td class="table-cell">
                            <form method="post" action="{% url 'account-admin:phone_delete' phone.id %}" onsubmit="return confirm('Are you sure?')">
                            {% csrf_token %}
                            <button class="btn btn--small btn--change" type="submit">{% trans "Unregister" %}</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </table>
            {% endif %}
            <p><a href="{% url 'account-admin:phone_create' %}"
            class="btn btn--create"><span class="fa fa-plus"></span> {% trans "Add Phone Number" %}</a></p>
    	</fieldset>
    </div>

    <div class="[ content__inner ] [ box box--padded box--bordered ]">
    	<fieldset>
    		<legend>{% trans "Backup Tokens" %}</legend>
            <p>
              {% blocktrans %}If you don't have any device with you, you can access
                your account using backup tokens.{% endblocktrans %}
              {% blocktrans count counter=backup_tokens %}
                You have only one backup token remaining.
              {% plural %}
                You have {{ counter }} backup tokens remaining.
              {% endblocktrans %}
            </p>
            <p><a href="{% url 'account-admin:list_backup_tokens' %}"
                  class="btn">{% trans "Show Codes" %}</a></p>
    	</fieldset>
    </div>

    <div class="[ content__inner ] [ box box--padded box--bordered ]">
    	<fieldset>
    		<legend>{% trans "Disable Two-Factor Authentication" %}</legend>
            <p>{% blocktrans %}However we strongly discourage you to do so, you can
              also disable two-factor authentication for your account.{% endblocktrans %}</p>
            <p><a class="btn btn--delete" href="{% url 'account-admin:disable' %}">
              {% trans "Disable Two-Factor Authentication" %}</a></p>
          {% else %}
            <p>{% blocktrans %}Two-factor authentication is not enabled for your
              account. Enable two-factor authentication for enhanced account
              security.{% endblocktrans %}</p>
            <p><a href="{% url 'account-admin:setup' %}" class="btn btn--create">
              {% trans "Enable Two-Factor Authentication" %}</a>
            </p>
    	</fieldset>
    </div>
  {% endif %}
{% endblock %}
